{% extends "base.html" %}
{% import '_macros.html' as macros %} {# Importera makro-filen #}

{% block content %}
    <h1>{{ category.name }}</h1>
    {% if category.description %}
        <p class="lead">{{ category.description }}</p>
    {% endif %}

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.new_thread', slug=category.slug) }}" class="btn btn-success">Starta Ny Tråd i {{ category.name }}</a>
            {% endif %}
            <a href="{{ url_for('main.forum_index') }}" class="btn btn-outline-secondary">Tillbaka till Forum Index</a>
        </div>
        {# Paginering LÄNGST UPP #}
        <div>
{{ macros.pagination_widget(pagination, 'main.view_category', slug=category.slug) }} {# Skicka slug explicit #}        </div>
    </div>


    {% if threads %}
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Tråd</th>
                    <th>Startad av</th>
                    <th>Svar</th>
                    <th>Senaste Inlägg</th>
                </tr>
            </thead>
            <tbody>
                {# Loopa igenom 'threads' som nu är paginerad #}
                {% for thread in threads %}
                    <tr>
                        <td>
                            <a href="{{ url_for('main.view_thread', thread_id=thread.id) }}">{{ thread.title }}</a>
                            <small class="text-muted d-block">Skapad: {{ thread.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                        </td>
                        <td>{{ thread.author.username if thread.author else 'Okänd' }}</td>
                        <td>{{ thread.posts.count() - 1 if thread.posts.count() > 0 else 0 }}</td>
                        <td>
                            <small class="text-muted">{{ thread.last_post_at.strftime('%Y-%m-%d %H:%M') if thread.last_post_at else '-' }}</small>
                            {# TODO: Visa vem som skrev senaste #}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Det finns inga trådar i denna kategori ännu.</p>
        {% if current_user.is_authenticated %}
             <p>Var den första att <a href="{{ url_for('main.new_thread', slug=category.slug) }}">starta en ny tråd</a>!</p>
        {% endif %}
    {% endif %}

    {# Paginering LÄNGST NER #}
    <div class="mt-3">
{{ macros.pagination_widget(pagination, 'main.view_category', slug=category.slug) }} {# Skicka slug explicit #}    </div>

{% endblock content %}